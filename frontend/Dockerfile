# --- Этап 1: Сборка статических файлов ---
# Используем официальный образ Node.js (версия 20, alpine - легковесная)
FROM node:20.14.0-alpine AS builder

# Устанавливаем рабочую директорию
WORKDIR /app

# Копируем package.json и package-lock.json для установки зависимостей
COPY package*.json ./

# Устанавливаем зависимости
RUN npm install

# Копируем весь остальной код приложения
COPY . .

# Собираем приложение в статические файлы
RUN npm run build

# --- Этап 2: Сервер для раздачи статики ---
# Используем официальный легковесный образ Nginx
FROM nginx:1.27.0-alpine

# Копируем ТОЛЬКО собранные файлы из папки /app/dist со "строительного" этапа
# в папку Nginx, из которой он раздает файлы по умолчанию.
COPY --from=builder /app/dist /usr/share/nginx/html

# Указываем, что контейнер будет слушать порт 80 (стандартный для Nginx)
EXPOSE 80

# Команда для запуска Nginx в режиме, который не позволяет контейнеру завершиться
CMD ["nginx", "-g", "daemon off;"]